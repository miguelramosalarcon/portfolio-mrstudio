---
import certificationsData from '../../data/certifications.json';

// Ordenar certificaciones: destacadas primero, luego por fecha (m√°s reciente primero)
const certifications = certificationsData.sort((a, b) => {
  // Primero destacadas
  if (a.featured && !b.featured) return -1;
  if (!a.featured && b.featured) return 1;
  
  // Luego por fecha (m√°s reciente primero)
  return b.date.localeCompare(a.date);
});

// Obtener a√±os √∫nicos para filtros
const years = [...new Set(certifications.map(c => c.date.substring(0, 4)))].sort().reverse();

// Obtener categor√≠as √∫nicas
const categories = [...new Set(certifications.map(c => c.category))].sort();

// Calcular total de horas
const totalHours = certifications.reduce((sum, cert) => sum + cert.hours, 0);

// Formatear fecha para mostrar
function formatDate(dateStr) {
  const months = {
    '01': 'Ene', '02': 'Feb', '03': 'Mar', '04': 'Abr',
    '05': 'May', '06': 'Jun', '07': 'Jul', '08': 'Ago',
    '09': 'Set', '10': 'Oct', '11': 'Nov', '12': 'Dic'
  };
  const [year, month] = dateStr.split('-');
  return `${months[month]} ${year}`;
}
---

<section id="certificaciones" class="certifications-section section">
  <div class="container">
    <!-- Header -->
    <div class="section-header">
      <h2 class="section-title">
        <span class="title-icon">üéì</span>
        Certificaciones y Cursos Profesionales
      </h2>
      <p class="section-subtitle">
        {certifications.length} cursos completados | {totalHours} horas de formaci√≥n continua
      </p>
    </div>
    
    <!-- Filtros -->
    <div class="filters">
      <div class="filter-group">
        <label class="filter-label">A√±o:</label>
        <div class="filter-buttons" role="group" aria-label="Filtrar por a√±o">
          <button class="filter-btn active" data-filter="year" data-value="all">
            Todos ({certifications.length})
          </button>
          {years.map(year => (
            <button class="filter-btn" data-filter="year" data-value={year}>
              {year} ({certifications.filter(c => c.date.startsWith(year)).length})
            </button>
          ))}
        </div>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Categor√≠a:</label>
        <div class="filter-buttons" role="group" aria-label="Filtrar por categor√≠a">
          <button class="filter-btn active" data-filter="category" data-value="all">
            Todas
          </button>
          {categories.map(category => (
            <button class="filter-btn" data-filter="category" data-value={category}>
              {category}
            </button>
          ))}
        </div>
      </div>
    </div>
    
    <!-- Lista de certificaciones -->
    <div class="certifications-list" id="certifications-list">
      {certifications.map((cert) => (
        <div 
          class="cert-item" 
          data-year={cert.date.substring(0, 4)}
          data-category={cert.category}
        >
          <article class="cert-card">
            <!-- Icono -->
            <div class="cert-icon-wrapper">
              <span class="cert-icon">{cert.icon}</span>
            </div>
            
            <!-- Contenido -->
            <div class="cert-content">
              <div class="cert-header">
                <h3 class="cert-name">{cert.name}</h3>
                {cert.featured && (
                  <span class="cert-badge">‚≠ê Destacado</span>
                )}
              </div>
              
              <div class="cert-meta">
                <span class="cert-institution">üè¢ {cert.institution}</span>
                <span class="cert-date">üìÖ {formatDate(cert.date)}</span>
                <span class="cert-hours">‚è±Ô∏è {cert.hours} horas</span>
              </div>
              
              <!-- Tags -->
              <div class="cert-tags">
                {cert.tags.map(tag => (
                  <span class="cert-tag">{tag}</span>
                ))}
              </div>
            </div>
          </article>
        </div>
      ))}
    </div>
    
    <!-- Mensaje cuando no hay resultados -->
    <div class="no-results" id="no-results-certs" style="display: none;">
      <p>üòï No se encontraron cursos con estos filtros.</p>
      <button class="btn-reset-filters-certs">Limpiar filtros</button>
    </div>
  </div>
</section>

<style>
  .certifications-section {
    background: var(--color-background-secondary);
    padding: var(--space-4xl) 0;
  }
  
  /* Header */
  .section-header {
    text-align: center;
    margin-bottom: var(--space-3xl);
  }
  
  .section-title {
    font-size: var(--text-4xl);
    color: var(--color-primary);
    margin-bottom: var(--space-md);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-md);
  }
  
  .title-icon {
    font-size: var(--text-5xl);
  }
  
  .section-subtitle {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
  }
  
  /* Filtros */
  .filters {
    display: flex;
    flex-direction: column;
    gap: var(--space-xl);
    margin-bottom: var(--space-3xl);
    padding: var(--space-xl);
    background: var(--color-background);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-border);
  }
  
  .filter-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }
  
  .filter-label {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text);
  }
  
  .filter-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
  }
  
  .filter-btn {
    padding: var(--space-sm) var(--space-lg);
    border: 2px solid var(--color-border);
    background: var(--color-background);
    color: var(--color-text-secondary);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  
  .filter-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
    background: rgba(var(--color-primary-rgb), 0.05);
  }
  
  .filter-btn.active {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
  }
  
  /* Lista de certificaciones */
  .certifications-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
  }
  
  .cert-item {
    animation: fadeInUp 0.5s ease-out;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Card de certificaci√≥n */
  .cert-card {
    display: flex;
    gap: var(--space-xl);
    padding: var(--space-xl);
    background: var(--color-background);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-border);
    transition: all var(--transition-base);
  }
  
  .cert-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 61, 166, 0.1);
    border-color: var(--color-primary-light);
  }
  
  /* Icono */
  .cert-icon-wrapper {
    flex-shrink: 0;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
    border-radius: var(--radius-lg);
  }
  
  .cert-icon {
    font-size: 2rem;
  }
  
  /* Contenido */
  .cert-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }
  
  .cert-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-md);
  }
  
  .cert-name {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--color-text);
    margin: 0;
    line-height: 1.4;
  }
  
  .cert-badge {
    flex-shrink: 0;
    padding: var(--space-xs) var(--space-sm);
    background: linear-gradient(135deg, #F5B83A, #F5B841);
    color: var(--color-primary);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: 700;
    white-space: nowrap;
  }
  
  /* Meta informaci√≥n */
  .cert-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-lg);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
  }
  
  .cert-institution,
  .cert-date,
  .cert-hours {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }
  
  /* Tags */
  .cert-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
  }
  
  .cert-tag {
    padding: var(--space-xs) var(--space-sm);
    background: var(--color-primary-light);
    color: white;
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    font-weight: 600;
  }
  
  /* Mensaje sin resultados */
  .no-results {
    text-align: center;
    padding: var(--space-3xl);
    background: var(--color-background);
    border-radius: var(--radius-lg);
    border: 2px dashed var(--color-border);
  }
  
  .no-results p {
    font-size: var(--text-xl);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-lg);
  }
  
  .btn-reset-filters-certs {
    padding: var(--space-md) var(--space-xl);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  
  .btn-reset-filters-certs:hover {
    background: var(--color-primary-light);
    transform: translateY(-2px);
  }
  
  /* Dark mode */
  [data-theme="dark"] .cert-card {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  [data-theme="dark"] .cert-card:hover {
    box-shadow: 0 8px 24px rgba(36, 72, 166, 0.2);
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .cert-card {
      flex-direction: column;
      gap: var(--space-md);
    }
    
    .cert-icon-wrapper {
      width: 50px;
      height: 50px;
    }
    
    .cert-icon {
      font-size: 1.5rem;
    }
    
    .cert-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .cert-meta {
      flex-direction: column;
      gap: var(--space-sm);
    }
    
    .filter-buttons {
      flex-direction: column;
    }
    
    .filter-btn {
      width: 100%;
    }
  }
</style>

<script>
  // Filtros de certificaciones
  const filterButtons = document.querySelectorAll('.certifications-section .filter-btn');
  const certItems = document.querySelectorAll('.cert-item');
  const noResults = document.getElementById('no-results-certs');
  const btnResetFilters = document.querySelector('.btn-reset-filters-certs');
  
  let activeFilters = {
    year: 'all',
    category: 'all'
  };
  
  function filterCertifications() {
    let visibleCount = 0;
    
    certItems.forEach((item) => {
      const year = item.getAttribute('data-year');
      const category = item.getAttribute('data-category');
      
      // Verificar filtro de a√±o
      const yearMatch = activeFilters.year === 'all' || year === activeFilters.year;
      
      // Verificar filtro de categor√≠a
      const categoryMatch = activeFilters.category === 'all' || category === activeFilters.category;
      
      // Mostrar/ocultar (CON TYPE ASSERTION)
      if (yearMatch && categoryMatch) {
        (item as HTMLElement).style.display = 'block';
        visibleCount++;
      } else {
        (item as HTMLElement).style.display = 'none';
      }
    });
    
    // Mostrar mensaje si no hay resultados
    if (noResults) {
      (noResults as HTMLElement).style.display = visibleCount === 0 ? 'block' : 'none';
    }
  }
  
  // Event listeners para botones de filtro
  filterButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const filterType = btn.getAttribute('data-filter');
      const filterValue = btn.getAttribute('data-value');
      
      if (!filterType || !filterValue) return;
      
      // Actualizar estado activo
      activeFilters[filterType as 'year' | 'category'] = filterValue;
      
      // Actualizar clases activas
      const group = btn.closest('.filter-buttons');
      group?.querySelectorAll('.filter-btn').forEach((b) => b.classList.remove('active'));
      btn.classList.add('active');
      
      // Aplicar filtros
      filterCertifications();
    });
  });
  
  // Reset filters
  btnResetFilters?.addEventListener('click', () => {
    activeFilters = { year: 'all', category: 'all' };
    
    filterButtons.forEach((btn) => {
      if (btn.getAttribute('data-value') === 'all') {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
    
    filterCertifications();
  });
</script>