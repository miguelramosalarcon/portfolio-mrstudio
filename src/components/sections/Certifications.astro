---
import certificationsData from '../../data/certifications.json';

// Ordenar certificaciones por fecha (m√°s reciente primero)
const certifications = certificationsData.sort((a, b) => {
  return b.date.localeCompare(a.date);
});

// Obtener a√±os √∫nicos para filtros
const years = [...new Set(certifications.map(c => c.date.substring(0, 4)))].sort().reverse();

// Obtener categor√≠as √∫nicas
const categories = [...new Set(certifications.map(c => c.category))].sort();

// Calcular total de horas
const totalHours = certifications.reduce((sum, cert) => sum + cert.hours, 0);

// Agrupar por a√±o
const certsByYear = years.map(year => ({
  year,
  courses: certifications.filter(c => c.date.startsWith(year)),
  totalHours: certifications.filter(c => c.date.startsWith(year)).reduce((sum, c) => sum + c.hours, 0)
}));

// Formatear fecha para mostrar
function formatDate(dateStr) {
  const months = {
    '01': 'Ene', '02': 'Feb', '03': 'Mar', '04': 'Abr',
    '05': 'May', '06': 'Jun', '07': 'Jul', '08': 'Ago',
    '09': 'Set', '10': 'Oct', '11': 'Nov', '12': 'Dic'
  };
  const [year, month] = dateStr.split('-');
  return `${months[month]} ${year}`;
}
---

<section id="certificaciones" class="certifications-section section">
  <div class="container">
    <!-- Header -->
    <div class="section-header">
      <h2 class="section-title">
        <span class="title-icon">üéì</span>
        Certificaciones y Cursos Profesionales
      </h2>
      <p class="section-subtitle">
        {certifications.length} cursos completados | {totalHours} horas de formaci√≥n continua
      </p>
    </div>
    
    <!-- Filtros -->
    <div class="filters">
      <div class="filter-group">
        <label class="filter-label">A√±o:</label>
        <div class="filter-buttons" role="group" aria-label="Filtrar por a√±o">
          <button class="filter-btn active" data-filter="year" data-value="all">
            Todos ({certifications.length})
          </button>
          {years.map(year => (
            <button class="filter-btn" data-filter="year" data-value={year}>
              {year} ({certifications.filter(c => c.date.startsWith(year)).length})
            </button>
          ))}
        </div>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Categor√≠a:</label>
        <div class="filter-buttons" role="group" aria-label="Filtrar por categor√≠a">
          <button class="filter-btn active" data-filter="category" data-value="all">
            Todas
          </button>
          {categories.map(category => (
            <button class="filter-btn" data-filter="category" data-value={category}>
              {category}
            </button>
          ))}
        </div>
      </div>
    </div>
    
    <!-- Timeline de certificaciones -->
    <div class="timeline">
      {certsByYear.map(({ year, courses, totalHours: yearHours }) => (
        <div class="timeline-year animate-on-scroll" data-year={year}>
          <div class="year-header">
            <div class="year-marker"></div>
            <h3 class="year-title">{year}</h3>
            <span class="year-info">{courses.length} cursos ‚Ä¢ {yearHours} horas</span>
          </div>
          
          <div class="timeline-items">
            {courses.map((cert, index) => (
              <div 
                class="timeline-item animate-on-scroll" 
                data-year={year}
                data-category={cert.category}
                style={`animation-delay: ${index * 0.1}s`}
              >
                <div class="timeline-marker">
                  <span class="cert-icon">{cert.icon}</span>
                </div>
                
                <div class="timeline-content">
                  <div class="cert-header">
                    <h4 class="cert-name">{cert.name}</h4>
                    {cert.featured && (
                      <span class="cert-badge">‚≠ê Destacado</span>
                    )}
                  </div>
                  
                  <div class="cert-meta">
                    <span class="cert-institution">üè¢ {cert.institution}</span>
                    <span class="cert-date">üìÖ {formatDate(cert.date)}</span>
                    <span class="cert-hours">‚è±Ô∏è {cert.hours} horas</span>
                  </div>
                  
                  <div class="cert-tags">
                    {cert.tags.map(tag => (
                      <span class="cert-tag">{tag}</span>
                    ))}
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      ))}
    </div>
    
    <!-- Mensaje cuando no hay resultados -->
    <div class="no-results" id="no-results-certs" style="display: none;">
      <p>üòï No se encontraron cursos con estos filtros.</p>
      <button class="btn-reset-filters-certs">Limpiar filtros</button>
    </div>
  </div>
</section>

<style>
  .certifications-section {
    background: var(--color-background-secondary);
    padding: var(--space-4xl) 0;
  }
  
  /* Header */
  .section-header {
    text-align: center;
    margin-bottom: var(--space-3xl);
  }
  
  .section-title {
    font-size: var(--text-4xl);
    color: var(--color-primary);
    margin-bottom: var(--space-md);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-md);
  }
  
  .title-icon {
    font-size: var(--text-5xl);
  }
  
  .section-subtitle {
    font-size: var(--text-lg);
    color: var(--color-text-secondary);
  }
  
  /* Filtros */
  .filters {
    display: flex;
    flex-direction: column;
    gap: var(--space-xl);
    margin-bottom: var(--space-3xl);
    padding: var(--space-xl);
    background: var(--color-background);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-border);
  }
  
  .filter-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }
  
  .filter-label {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text);
  }
  
  .filter-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
  }
  
  .filter-btn {
    padding: var(--space-sm) var(--space-lg);
    border: 2px solid var(--color-border);
    background: var(--color-background);
    color: var(--color-text-secondary);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  
  .filter-btn:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
    background: rgba(var(--color-primary-rgb), 0.05);
  }
  
  .filter-btn.active {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
  }
  
  /* Timeline */
  .timeline {
    position: relative;
    max-width: 1000px;
    margin: 0 auto;
  }
  
  /* A√±o en timeline */
  .timeline-year {
    margin-bottom: var(--space-3xl);
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.6s ease-out;
  }
  
  .timeline-year.animate-in {
    opacity: 1;
    transform: translateY(0);
  }
  
  .year-header {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
    margin-bottom: var(--space-2xl);
    position: relative;
  }
  
  .year-marker {
    width: 20px;
    height: 20px;
    background: var(--color-primary);
    border-radius: 50%;
    border: 4px solid var(--color-background);
    box-shadow: 0 0 0 4px var(--color-primary-light);
    flex-shrink: 0;
    z-index: 2;
  }
  
  .year-title {
    font-size: var(--text-2xl);
    font-weight: 700;
    color: var(--color-primary);
    margin: 0;
  }
  
  .year-info {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    font-weight: 600;
  }
  
  /* Items de timeline */
  .timeline-items {
    position: relative;
    padding-left: var(--space-xl);
    border-left: 3px solid var(--color-primary-light);
    margin-left: 9px;
  }
  
  .timeline-item {
    position: relative;
    margin-bottom: var(--space-xl);
    opacity: 0;
    transform: translateX(-20px);
    transition: all 0.5s ease-out;
  }
  
  .timeline-item.animate-in {
    opacity: 1;
    transform: translateX(0);
  }
  
  .timeline-item:last-child {
    margin-bottom: 0;
  }
  
  .timeline-marker {
    position: absolute;
    left: calc(-1 * var(--space-xl) - 27px);
    top: 0;
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--color-primary), var(--color-primary-light));
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 61, 166, 0.2);
    z-index: 2;
  }
  
  .timeline-marker .cert-icon {
    font-size: 1.5rem;
  }
  
  /* Contenido del curso */
  .timeline-content {
    background: var(--color-background);
    padding: var(--space-xl);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-border);
    transition: all var(--transition-base);
  }
  
  .timeline-content:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 61, 166, 0.1);
    border-color: var(--color-primary-light);
  }
  
  .cert-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--space-md);
    margin-bottom: var(--space-md);
  }
  
  .cert-name {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--color-text);
    margin: 0;
    line-height: 1.4;
  }
  
  .cert-badge {
    flex-shrink: 0;
    padding: var(--space-xs) var(--space-sm);
    background: linear-gradient(135deg, #F5B83A, #F5B841);
    color: var(--color-primary);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: 700;
    white-space: nowrap;
  }
  
  /* Meta informaci√≥n */
  .cert-meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-lg);
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-md);
  }
  
  .cert-institution,
  .cert-date,
  .cert-hours {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
  }
  
  /* Tags */
  .cert-tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
  }
  
  .cert-tag {
    padding: var(--space-xs) var(--space-sm);
    background: var(--color-primary-light);
    color: white;
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    font-weight: 600;
  }
  
  /* Mensaje sin resultados */
  .no-results {
    text-align: center;
    padding: var(--space-3xl);
    background: var(--color-background);
    border-radius: var(--radius-lg);
    border: 2px dashed var(--color-border);
    max-width: 1000px;
    margin: 0 auto;
  }
  
  .no-results p {
    font-size: var(--text-xl);
    color: var(--color-text-secondary);
    margin-bottom: var(--space-lg);
  }
  
  .btn-reset-filters-certs {
    padding: var(--space-md) var(--space-xl);
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius-md);
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-fast);
  }
  
  .btn-reset-filters-certs:hover {
    background: var(--color-primary-light);
    transform: translateY(-2px);
  }
  
  /* Dark mode */
  [data-theme="dark"] .timeline-content {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  [data-theme="dark"] .timeline-content:hover {
    box-shadow: 0 8px 24px rgba(36, 72, 166, 0.2);
  }
  
  [data-theme="dark"] .year-marker {
    border-color: rgba(255, 255, 255, 0.05);
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    .timeline-items {
      padding-left: var(--space-md);
      margin-left: 5px;
    }
    
    .timeline-marker {
      left: calc(-1 * var(--space-md) - 23px);
      width: 40px;
      height: 40px;
    }
    
    .timeline-marker .cert-icon {
      font-size: 1.2rem;
    }
    
    .year-marker {
      width: 16px;
      height: 16px;
    }
    
    .year-title {
      font-size: var(--text-xl);
    }
    
    .cert-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .cert-meta {
      flex-direction: column;
      gap: var(--space-sm);
    }
    
    .filter-buttons {
      flex-direction: column;
    }
    
    .filter-btn {
      width: 100%;
    }
  }
</style>

<script>
  // ========================================
  // ANIMACIONES SCROLL (como Experience)
  // ========================================
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-in');
      }
    });
  }, observerOptions);

  // Observar a√±os y items para animaciones
  const timelineYears = document.querySelectorAll('.timeline-year');
  const timelineItems = document.querySelectorAll('.timeline-item');
  
  timelineYears.forEach((year) => observer.observe(year));
  timelineItems.forEach((item) => observer.observe(item));

  // ========================================
  // FILTROS DE CERTIFICACIONES
  // ========================================
  const filterButtons = document.querySelectorAll('.certifications-section .filter-btn');
  const noResults = document.getElementById('no-results-certs');
  const btnResetFilters = document.querySelector('.btn-reset-filters-certs');
  
  let activeFilters = {
    year: 'all',
    category: 'all'
  };
  
  function filterCertifications() {
    let visibleYearsCount = 0;
    let totalVisibleItems = 0;
    
    // Filtrar por a√±o y categor√≠a
    timelineYears.forEach((yearSection) => {
      const yearValue = yearSection.getAttribute('data-year');
      const itemsInYear = yearSection.querySelectorAll('.timeline-item');
      let visibleInYear = 0;
      
      // Verificar filtro de a√±o
      const yearMatch = activeFilters.year === 'all' || yearValue === activeFilters.year;
      
      if (!yearMatch) {
        (yearSection as HTMLElement).style.display = 'none';
        return;
      }
      
      // Filtrar items dentro del a√±o
      itemsInYear.forEach((item) => {
        const category = item.getAttribute('data-category');
        const categoryMatch = activeFilters.category === 'all' || category === activeFilters.category;
        
        if (categoryMatch) {
          (item as HTMLElement).style.display = 'block';
          visibleInYear++;
          totalVisibleItems++;
        } else {
          (item as HTMLElement).style.display = 'none';
        }
      });
      
      // Mostrar/ocultar a√±o completo
      if (visibleInYear > 0) {
        (yearSection as HTMLElement).style.display = 'block';
        visibleYearsCount++;
      } else {
        (yearSection as HTMLElement).style.display = 'none';
      }
    });
    
    // Mostrar mensaje si no hay resultados
    if (noResults) {
      (noResults as HTMLElement).style.display = totalVisibleItems === 0 ? 'block' : 'none';
    }
  }
  
  // Event listeners para botones de filtro
  filterButtons.forEach((btn) => {
    btn.addEventListener('click', () => {
      const filterType = btn.getAttribute('data-filter');
      const filterValue = btn.getAttribute('data-value');
      
      if (!filterType || !filterValue) return;
      
      // Actualizar estado activo
      activeFilters[filterType as 'year' | 'category'] = filterValue;
      
      // Actualizar clases activas
      const group = btn.closest('.filter-buttons');
      group?.querySelectorAll('.filter-btn').forEach((b) => b.classList.remove('active'));
      btn.classList.add('active');
      
      // Aplicar filtros
      filterCertifications();
    });
  });
  
  // Reset filters
  btnResetFilters?.addEventListener('click', () => {
    activeFilters = { year: 'all', category: 'all' };
    
    filterButtons.forEach((btn) => {
      if (btn.getAttribute('data-value') === 'all') {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    });
    
    filterCertifications();
  });
</script>